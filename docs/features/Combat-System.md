# Combat-System

## 1. 戦闘の基本コンセプト
RogueFの戦闘は、従来のターン制ローグライクとは異なり、**リアルタイム/アクティブタイム制**を採用します。プレイヤーとモンスターは、それぞれの「待機時間（クールタイム）」が経過するたびに行動が可能になります。

## 2. バトルシステム詳細

### 2.1 リアルタイム性
- 全てのエンティティ（プレイヤー、モンスター）は独立したタイマーを持ちます。
- 行動（攻撃、アイテム使用等）を行うと、その行動に応じたクールタイムが発生します。

### 2.2 攻撃と待機時間
- **攻撃速度 (Attack Speed)**: ステータスによって基本クールタイムが短縮されます。
- **クールタイム (攻撃インターバル)**:
    - プレイヤーの攻撃: 基本 1.0秒（敏捷性により変動）
    - モンスターの攻撃: モンスターの種類により 1.5秒〜3.0秒
- **計算式**:
    - `攻撃インターバル = 基本インターバル / (1 + 敏捷性 / 100)`
    - 例: 敏捷性が 100 の場合、インターバルは 0.5秒（速度2倍）になります。
- クールタイム中は次の攻撃が行えません。UI上でプログレスバー等によりクールタイムを表示します。

### 2.3 ダメージ計算式
ダメージ量は以下の式をベースに算出します。

`ダメージ = (攻撃力 * 乱数(0.9〜1.1)) - (防御力 / 2)`

- 最小ダメージは 1 とします。

### 2.4 命中と回避
命中判定は、攻撃側の「器用さ」と防御側の「素早さ」を用いて算出します。

- **命中率計算式**:
    - `命中率(%) = 90 + (自身の器用さ - 敵の素早さ) * 2`
- **制約**:
    - 命中率の下限は 50%、上限は 100% とします。

## 3. モンスターAIパターン

モンスターは以下のいずれかの思考ルーチンを持ちます。

### 3.1 積極的 (Aggressive)
- プレイヤーを視界（8マス程度）に捉えると、最短距離で接近し、隣接すると攻撃を繰り返します。

### 3.2 遠距離型 (Ranged)
- プレイヤーと一定の距離（3〜4マス）を保とうとします。
- 距離が近い場合は離れ、離れすぎている場合は近づきます。
- 射程内に入ると遠距離攻撃を行います。

### 3.3 臆病 (Cowardly)
- HPが一定割合（例: 20%）以下になると、プレイヤーから逃げるように移動します。

### 3.4 ランダム (Random)
- 特定の目的を持たず、ランダムな方向に移動します。

## 4. 状態異常
戦闘を深めるため、以下の状態異常を定義します。
- **スタン**: 一定時間、全ての行動が不能になる。
- **毒**: 一定時間ごとにダメージを受ける。
- **鈍足**: クールタイムの回復速度が半減する。
