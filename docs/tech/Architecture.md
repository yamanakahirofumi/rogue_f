# アーキテクチャ設計

本プロジェクトでは、2Dオープンワールドの複雑な状態管理と描画、およびユーザー入力を効率的に処理するため、Angular のコンポーネント指向設計を採用しています。

## 1. ディレクトリ構造
標準的な Angular CLI の構造に準拠しています。

```
.
├── angular.json           # Angular プロジェクト設定
├── package.json           # 依存関係管理 (npm)
├── src
│   ├── app
│   │   ├── admin/         # 管理画面用コンポーネント
│   │   ├── fields/        # ゲームフィールド画面用コンポーネント
│   │   │   ├── dungeon/   # ダンジョン描画
│   │   │   ├── player/    # プレイヤー情報
│   │   │   ├── services/  # フィールド関連のビジネスロジック (Service)
│   │   │   └── d/         # ドメインモデル・ロジック
│   │   ├── random/        # 乱数生成ユーティリティ
│   │   ├── app.module.ts  # メインモジュール
│   │   └── app-routing.module.ts # ルーティング
│   ├── assets/            # 画像、設定ファイル等の静的リソース
│   └── environments/      # 環境別設定
```

## 2. 主要コンポーネントの責務

### 2.1 Domain / Model (`src/app/fields/d/`)
- アプリケーションのビジネスルールとデータを保持します。
- Angular の依存関係から切り離された純粋な TypeScript クラス/インターフェースとして定義します。

### 2.2 Service 層 (`src/app/fields/services/`)
- API 通信、データの永続化、コンポーネント間での状態共有を担当します。
- `Injectable` として定義され、DI（依存性の注入）を通じて利用されます。

### 2.3 Component 層
- UI の描画とユーザーイベントのハンドリングを担当します。
- **Container Component**：Service と連携し、データを下位コンポーネントへ渡します。
- **Presentational Component**：受け取ったデータを表示することに専念し、イベントを親へ通知します。

## 3. デザイン方針
- **コンポーネントの分割**：再利用性と保守性を高めるため、責務が大きくなりすぎないよう適切にコンポーネントを分割します。
- **RxJS の活用**：非同期処理やイベントストリームの管理には RxJS を活用します。
- **不変性 (Immutability)**：状態管理においては、予期せぬ副作用を防ぐため不変性を意識したデータ操作を行います。
